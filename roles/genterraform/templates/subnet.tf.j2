{% for bus_unit in business_units %}
{% for subnet in bus_unit.vpc.subnets %}
resource "aws_subnet" "{{ subnet.name }}" {
  count = length( "{{ subnet.cidrs | length }}" )
  vpc_id     = "{{ bus_unit.vpc.name}}.id"
  cidr_block = element( {{ subnet.cidrs | regex_replace('\'', '"') }}, count.index )
  availability_zone = element( {{ subnet.availability_zones | regex_replace('\'', '"') }}, count.index )

  tags = {
    generated: "VPC Terraform resource {{ subnet.name }} generated by Ansible"
    Name = "{{ subnet.description }} ${count.index + 1}"
  }
} 
{% endfor %}
{% endfor %}
